---
title: "Objetivo General"
author: "Samuel Espiño, Lucía Gil, Alvar Tomás Ortiz"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Objetivos específicos: 

 Relación de disminución de enfermedades por cultivos trangénicos

## Enlaces de bases de datos relacionados con el tema

Conjunto de datos globales georreferenciado de 173 cultivos alrededor de 2020: [Here](https://figshare.com/articles/dataset/CROPGRIDS/22491997?file=41952177)

Insuficiencia cardiaca: [Here](https://ec.europa.eu/eurostat/databrowser/view/hlth_ehis_pa2u/default/table?lang=en)

Cancer de colon: [Here](https://ec.europa.eu/eurostat/databrowser/view/hlth_ehis_pa5u/default/table?lang=en)

Indice de abortos en Europa: [Here](https://ec.europa.eu/eurostat/databrowser/view/demo_fabortind/default/table?lang=en) 

Cancer de mama : [Here](https://ec.europa.eu/eurostat/databrowser/view/hlth_ps_scre__custom_8587007/default/table?lang=en)

Cardiopatias isquémicas: [Here](https://gateway.euro.who.int/en/indicators/hfamdb_427-deaths-ischaemic-heart-disease/#id=30289)

## Librerias que importamos para el trabajo
```{r}
library(tidyverse)
library(readxl)
library(rjson)
library(tidyjson)
library(readxl)
library(ggplot2)
```

## Tablas de valores

```{r}
aborto <- read_delim("INPUT/DATA/datos_aborto.tsv", 
    delim = "\t", escape_double = FALSE, 
    trim_ws = TRUE) %>%
    separate(col = 1, into = c("A","ABORT","RT","Pais"), sep = ",") %>%
    mutate(across("2013":"2021", ~na_if(.,":"))) %>%
    mutate(across("2013":"2021", ~as.numeric(.))) %>% 
    select(.,Pais,"2013":"2021") %>%
    pivot_longer(
    cols = "2013":"2021",
    names_to = "Años",
    values_to = "Valores"
  )
aborto
```


```{r}
d_mama <- read_delim("INPUT/DATA/datos_cancer_mama.tsv", 
    delim = "\t", escape_double = FALSE, 
    trim_ws = TRUE) %>% 
  separate(col = 1, into = c("A","PC","PGR","C50","Pais"), sep = ",") %>%
  mutate(across("2000":"2021", ~na_if(.,":"))) %>% 
  select(.,Pais,"2000":"2021") %>%
  pivot_longer(cols="2000":"2021",
               names_to = "Años",
               values_to = "Valores") %>%
  mutate(Valores = as.numeric(gsub("[^0-9.]", "", Valores)))
d_mama
```


```{r}
d_isquemia <- read_excel("INPUT/DATA/HFAMDB_427_EN.xlsx", 
    sheet = "Data (pivoted)") %>%
  select(.,COUNTRY_REGION,"2015":"2020") %>%
  pivot_longer(cols = -c("COUNTRY_REGION"),
               names_to = "Años",
               values_to = "Valor") %>%
  rename(.,Pais=COUNTRY_REGION)
d_isquemia
```

```{r}
d_cultivos <- read_excel("INPUT/DATA/Table_CROPGRIDS_COU.xlsx") %>%
  rename(Pais = "Country ISO2 code" )
d_cultivos

```
## Seleccionamos los datos 

Selección de los 3 cultivos que vamos a usar
```{r}
d_cultivos_e <- select(d_cultivos,Pais,cauliflower,cucumberetc,greenbean) %>%
  rename(Pepino="cucumberetc",Judía_verde="greenbean",Coliflor="cauliflower") %>%
  pivot_longer(cols = -Pais, names_to = "Cultivo", values_to = "Hectareas_cultivadas")

d_cultivos_e
```
Seleccion de la media de los años 2015-2020 en casos de cancer de mama
```{r}
casos_mama_media <- d_mama %>%
  filter(Años >= 2015 & Años <= 2020) %>%
  group_by(Pais) %>%
  summarise(Valor_Media = mean(Valores, na.rm = TRUE)) 
casos_mama_media
```
Selección de la media de los años 2015-2020 en casos de cardiopatias isquémicas
```{r}

paises <- read_excel("INPUT/DATA/HFAMDB_427_EN.xlsx", 
    sheet = "Countries") %>%
  select(.,"ISO 2","ISO 3") %>%
  inner_join(.,select(casos_mama_media,Pais), by = c("ISO 2" = "Pais"))

d_isquemia_media <- d_isquemia %>%
  filter(Años >= 2015 & Años <= 2020) %>%
  group_by(Pais) %>%
  summarise(Valor_Media = mean(Valor, na.rm = TRUE)) %>%
  rename (., Media_isquemia = Valor_Media) %>%
  inner_join(.,paises, by = c("Pais" = "ISO 3")) %>%
  relocate("ISO 2", .before =Media_isquemia) %>%
  select(.,"ISO 2", Media_isquemia) %>%
  rename(., Pais = "ISO 2") %>%
  mutate(., Media_isquemia = (Media_isquemia/sum(Media_isquemia)*100))
d_isquemia_media
```

Seleccion de la media de los años 2015-2020 en casos de abortos
```{r}
aborto_media <- aborto %>%
  filter(Años >= 2015 & Años <= 2020) %>%
  group_by(Pais) %>%
  summarise(Valor_Media = mean(Valores, na.rm = TRUE))
aborto_media
```
Creamos las tablas con la relación cultivos-enfermedad con cada una de ellas.
Aborto
```{r}
tabla_aborto <- left_join(aborto_media, d_cultivos_e, by = 'Pais') %>%
  rename(Media_abortos=Valor_Media) %>%
  relocate(Cultivo:Hectareas_cultivadas, .before =Media_abortos)
tabla_aborto
```
Cancer mama
```{r}
unif_mama_cult <- casos_mama_media %>%
  inner_join(., d_cultivos_e) %>%
  rename (.data = ., Media_Cancer = Valor_Media) %>%
  relocate (.data = ., Cultivo:Hectareas_cultivadas, .before = Media_Cancer)
unif_mama_cult
```
Isquemia
```{r}
tabla_isquemia <- d_isquemia_media %>%
  inner_join(.,d_cultivos_e) %>%
  relocate(Cultivo:Hectareas_cultivadas, .before =Media_isquemia) 
tabla_isquemia
```
Creamos las gráficas 
Aborto - Coliflor
```{r}
coliflor_aborto<- filter(tabla_aborto,Cultivo=="Coliflor")
ggplot(data = coliflor_aborto,  )+
  geom_smooth(aes(x = Hectareas_cultivadas, y = Media_abortos)) +
  labs(
    x = "Hectáreas cultivadas",
    y = "Media de abortos",
    title = "Media de abortos y número de hectáreas cultivadas de coliflor por países"
  )
```

Aborto - Pepino
```{r}
pepino_aborto<- filter(tabla_aborto,Cultivo=="Pepino")
ggplot(data = pepino_aborto )+
  geom_smooth(aes(x = Hectareas_cultivadas, y = Media_abortos)) +
  labs(
    x = "Hectáreas cultivadas",
    y = "Media de abortos",
    title = "Media de abortos y número de hectáreas cultivadas de pepino por países"
  )
```
Aborto - Judía
```{r}
judia_aborto<- filter(tabla_aborto,Cultivo=="Judía_verde")
ggplot(data = judia_aborto )+
  geom_smooth(aes(x = Hectareas_cultivadas, y = Media_abortos)) +
  labs(
    x = "Hectáreas cultivadas",
    y = "Media de abortos",
    title = "Media de abortos y número de hectáreas cultivadas de judia verde por países"
  )
```
Cancer - Coliflor 
```{r}
fig_c_coliflor <- ggplot(data = filter(unif_mama_cult,Cultivo=="Coliflor")) + 
  geom_smooth(
    mapping = aes (x = Hectareas_cultivadas, y = Media_Cancer),
    method = "lm"
  ) +
  labs(
    x = "Hectareas Cultivadas",
    y = "Media de Cancer",
    title = "Media de cáncer de mama y número de hectareas cultivadas de coliflor",
  )
fig_c_coliflor
```
Cancer - Pepino
```{r}
fig_c_pepino <- ggplot(data = filter(unif_mama_cult,Cultivo=="Pepino")) + 
  geom_smooth(
    mapping = aes (x = Hectareas_cultivadas, y = Media_Cancer),
    method = "lm",
  ) +
  labs(
    x = "Hectareas Cultivadas",
    y = "Media de Cancer",
    title = "Media de cáncer de mama y número de hectareas cultivadas de pepino",
  )
fig_c_pepino
```
Cancer - Judía
```{r}
fig_c_judia <-ggplot(data = filter(unif_mama_cult,Cultivo=="Judía_verde")) + 
  geom_smooth(
    mapping = aes (x = Hectareas_cultivadas, y = Media_Cancer),
    method = "lm"
  ) +
  labs(
    x = "Hectareas Cultivadas",
    y = "Media de Cancer",
    title = "Media de cáncer de mama y número de hectareas cultivadas de judías verdes",
  )
fig_c_judia
```
Isquemia - Coliflor
```{r}
fig_i_coliflor <- ggplot(data = filter(tabla_isquemia,Cultivo=="Coliflor")) + 
  geom_smooth(
    mapping = aes (x = Hectareas_cultivadas, y = Media_isquemia),
    method = "lm"
  ) +
  labs(
    x = "Hectareas Cultivadas",
    y = "Media de casos de isquemia cardiaca",
    title = "Media de casos de isquemia cardiaca y número de hectareas cultivadas de coliflor",
  )
fig_i_coliflor
```
Isquemia - Pepino
```{r}
fig_i_pepino <- ggplot(filter(tabla_isquemia,Cultivo=="Pepino")) + 
  geom_smooth(
    mapping = aes (x = Hectareas_cultivadas, y = Media_isquemia),
    method = "lm"
  ) +
  labs(
    x = "Hectareas Cultivadas",
    y = "Media de casos de isquemia cardiaca",
    title = "Media de casos de isquemia cardiaca y número de hectareas cultivadas de coliflor",
  )
fig_i_pepino
```
Isquemia - Judía
```{r}
fig_i_judia <- ggplot(data = filter(tabla_isquemia,Cultivo=="Judía_verde")) + 
  geom_smooth(
    mapping = aes (x = Hectareas_cultivadas, y = Media_isquemia),
    method = "lm"
  ) +
  labs(
    x = "Hectareas Cultivadas",
    y = "Media de casos de isquemia",
    title = "Media de casos de isquemia y número de hectareas cultivadas de coliflor",
  )
fig_i_judia
```

