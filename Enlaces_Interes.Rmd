---
title: "Objetivo General"
author: "Samuel Espiño, Lucía Gil, Alvar Tomás Ortiz"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Objetivos específicos: 

 Relación de disminución de enfermedades por cultivos trangénicos

## Enlaces de bases de datos relacionados con el tema

Conjunto de datos globales georreferenciado de 173 cultivos alrededor de 2020: [Here](https://figshare.com/articles/dataset/CROPGRIDS/22491997?file=41952177)

Insuficiencia cardiaca: [Here](https://ec.europa.eu/eurostat/databrowser/view/hlth_ehis_pa2u/default/table?lang=en)

Cancer de colon: [Here](https://ec.europa.eu/eurostat/databrowser/view/hlth_ehis_pa5u/default/table?lang=en)

Indice de abortos en Europa: [Here](https://ec.europa.eu/eurostat/databrowser/view/demo_fabortind/default/table?lang=en) 

Cancer de mama : [Here](https://ec.europa.eu/eurostat/databrowser/view/hlth_ps_scre__custom_8587007/default/table?lang=en)

Cardiopatias isquémicas: [Here] (https://gateway.euro.who.int/en/indicators/hfamdb_427-deaths-ischaemic-heart-disease/?id=30289)

## Librerias que importamos para el trabajo
```{r}
library(tidyverse)
library(readxl)
library(rjson)
library(tidyjson)
library(readxl)
library(ggplot2)
```

## Tablas de valores

```{r}
aborto <- read_delim("INPUT/DATA/datos_aborto.tsv", 
    delim = "\t", escape_double = FALSE, 
    trim_ws = TRUE)
aborto <- aborto %>%
    separate(col = 1, into = c("A","ABORT","RT","Pais"), sep = ",") %>%
    mutate(across("2013":"2021", ~na_if(.,":"))) %>%
    mutate(across("2013":"2021", ~as.numeric(.)))
aborto <- select(aborto,Pais,"2013":"2021")
aborto <- aborto %>%
  pivot_longer(
    cols = "2013":"2021",
    names_to = "Años",
    values_to = "Valores"
  )
aborto
```


```{r}
d_mama <- read_delim("INPUT/DATA/datos_cancer_mama.tsv", 
    delim = "\t", escape_double = FALSE, 
    trim_ws = TRUE)
d_mama <- d_mama %>% 
  separate(col = 1, into = c("A","PC","PGR","C50","Pais"), sep = ",") %>%
  mutate(across("2000":"2021", ~na_if(.,":")))
d_mama  <- select(d_mama,Pais,"2000":"2021")
d_mama <- d_mama %>%
  pivot_longer(cols="2000":"2021",
               names_to = "Años",
               values_to = "Valores") %>%
  mutate(Valores = as.numeric(gsub("[^0-9.]", "", Valores)))
d_mama
```


```{r}
d_isquemia <- read_excel("INPUT/DATA/HFAMDB_427_EN.xlsx", 
    sheet = "Data (pivoted)")
d_isquemia = select(d_isquemia,COUNTRY_REGION,"2015":"2020")
d_isquemia <- d_isquemia %>%
  pivot_longer(cols = -c("COUNTRY_REGION"),
               names_to = "Años",
               values_to = "Valor") %>%
  rename(.,Pais=COUNTRY_REGION)
d_isquemia
```

```{r}
d_cultivos <- read_excel("INPUT/DATA/Table_CROPGRIDS_COU.xlsx")
d_cultivos <- d_cultivos %>% rename(Pais = "Country ISO2 code" )
d_cultivos

```
## Seleccionamos los datos 

Selección de los 3 cultivos que vamos a usar
```{r}
d_cultivos_e <- select(d_cultivos,Pais,cauliflower,cucumberetc,greenbean)
d_cultivos_e <- d_cultivos_e %>% 
              rename(Pepino="cucumberetc",Judía_verde="greenbean",Coliflor="cauliflower")
d_cultivos_e <- d_cultivos_e %>%
  pivot_longer(cols = -Pais, names_to = "Cultivo", values_to = "Valores")

d_cultivos_e
```
Selección de la media de los años 2015-2020 en casos de cardiopatias isquémicas
```{r}
d_isquemia_media <- d_isquemia %>%
  filter(Años >= 2015 & Años <= 2020) %>%
  group_by(Pais) %>%
  summarise(Valor_Media = mean(Valor, na.rm = TRUE))
d_isquemia_media
```

Seleccion de la media de los años 2015-2020 en casos de cancer de mama
```{r}
casos_mama_media <- d_mama %>%
  filter(Años >= 2015 & Años <= 2020) %>%
  group_by(Pais) %>%
  summarise(Valor_Media = mean(Valores, na.rm = TRUE)) 
casos_mama_media
```

Seleccion de la media de los años 2015-2020 en casos de abortos
```{r}
aborto_media <- aborto %>%
  filter(Años >= 2015 & Años <= 2020) %>%
  group_by(Pais) %>%
  summarise(Valor_Media = mean(Valores, na.rm = TRUE))
aborto_media
```
Creamos las tablas con la relación cultivos-enfermedad con cada una de ellas.
Aborto
```{r}
tabla_aborto <- left_join(aborto_media, d_cultivos_e, by = 'Pais')
tabla_aborto <- tabla_aborto %>%
  rename(Media_abortos=Valor_Media)
tabla_aborto <- tabla_aborto %>%
  rename(Hectareas_cultivadas=Valores)
tabla_aborto<-tabla_aborto %>%
  relocate(Cultivo:Hectareas_cultivadas, .before =Media_abortos)
tabla_aborto
```
Cancer mama
```{r}
unif_mama_cult <- casos_mama_media %>%
  inner_join(., d_cultivos_e) %>%
  rename (.data = ., Media_Cancer = Valor_Media) %>%
  rename (.data = ., Hectareas_Cultivadas = Valores) %>%
  relocate (.data = ., Cultivo:Hectareas_Cultivadas, .before = Media_Cancer)
unif_mama_cult
```
Isquemia
```{r}

```
Creamos las gráficas 
Aborto - Coliflor
```{r}
coliflor_aborto <- tabla_aborto %>% 
  filter(Cultivo == "Coliflor")

ggplot(coliflor_aborto, aes(x = Pais)) +
  geom_col(aes(y = Media_abortos, fill = "Media de Abortos"), position = "dodge", width = 0.7) +
  geom_col(aes(y = Hectareas_cultivadas * 0.01, fill = "Hectáreas Cultivadas"), position = "dodge", width = 0.4) +
  labs(title = "Media de abortos y número de hectáreas cultivadas de coliflor por país",
       x = "País",
       y = "Valores",
       fill = "Leyenda") +
  scale_fill_manual(values = c("Media de Abortos" = "red", "Hectáreas Cultivadas" = "green"))
```

Aborto - Pepino
```{r}
pepino_aborto <- tabla_aborto %>% 
  filter(Cultivo == "Pepino")

ggplot(pepino_aborto, aes(x = Pais)) +
  geom_col(aes(y = Media_abortos, fill = "Media de Abortos"), position = "dodge", width = 0.7) +
  geom_col(aes(y = Hectareas_cultivadas * 0.01, fill = "Hectáreas Cultivadas"), position = "dodge", width = 0.4) +
  labs(title = "Media de abortos y número de hectáreas cultivadas de pepino por país",
       x = "País",
       y = "Valores",
       fill = "Leyenda") +
  scale_fill_manual(values = c("Media de Abortos" = "red", "Hectáreas Cultivadas" = "green"))
```
Aborto - Judía
```{r}

```
Cancer - Coliflor 
```{r}
coliflor_cancer <- unif_mama_cult %>% 
  filter(Cultivo == "Coliflor")

ggplot(coliflor_cancer, aes(x = Pais)) +
  geom_col(aes(y = Media_Cancer, fill = "Media de Cancer de mama"), position = "dodge", width = 0.7) +
  geom_col(aes(y = Hectareas_Cultivadas * 0.01, fill = "Hectáreas Cultivadas"), position = "dodge", width = 0.4) +
  labs(title = "Media de Cancer de mama y número de hectáreas cultivadas de coliflor por país",
       x = "País",
       y = "Valores",
       fill = "Leyenda") +
  scale_fill_manual(values = c("Media de Cancer de mama" = "red", "Hectáreas Cultivadas" = "green"))
```
Cancer - Pepino
```{r}
pepino_cancer <- unif_mama_cult %>% 
  filter(Cultivo == "Pepino")

ggplot(pepino_cancer, aes(x = Pais)) +
  geom_col(aes(y = Media_Cancer, fill = "Media de Cancer de mama"), position = "dodge", width = 0.7) +
  geom_col(aes(y = Hectareas_Cultivadas * 0.01, fill = "Hectáreas Cultivadas"), position = "dodge", width = 0.4) +
  labs(title = "Media de Cancer de mama y número de hectáreas cultivadas de pepino por país",
       x = "País",
       y = "Valores",
       fill = "Leyenda") +
  scale_fill_manual(values = c("Media de Cancer de mama" = "red", "Hectáreas Cultivadas" = "green"))
```
Cancer - Judía
```{r}
judia_cancer <- unif_mama_cult %>% 
  filter(Cultivo == "Judía_verde")

ggplot(judia_cancer, aes(x = Pais)) +
  geom_col(aes(y = Media_Cancer, fill = "Media de Cancer de mama"), position = "dodge", width = 0.7) +
  geom_col(aes(y = Hectareas_Cultivadas * 0.01, fill = "Hectáreas Cultivadas"), position = "dodge", width = 0.4) +
  labs(title = "Media de Cancer de mama y número de hectáreas cultivadas de judías verdes por país",
       x = "País",
       y = "Valores",
       fill = "Leyenda") +
  scale_fill_manual(values = c("Media de Cancer de mama" = "red", "Hectáreas Cultivadas" = "green"))
```
Isquemia - Coliflor
```{r}

```
Isquemia - Pepino
```{r}

```
Isquemia - Judía
```{r}

```

